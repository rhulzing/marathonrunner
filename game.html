<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phaser - Making your first game, part 1</title>
  <script type="text/javascript" src="js/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript" src="js/phaserLevelGenerator.js"></script>
<script type="text/javascript" src="js/tileLibraryIndex.js"></script>

<script type="text/javascript">

var game = new Phaser.Game(640, 480, Phaser.AUTO, '', { preload:
	preload, create: create, update: update, render: render});

function preload()
{
	game.load.image('title', 'game_assets/img/title.png');
	game.load.image('floor', 'game_assets/img/sprite/ground.png')
	game.load.spritesheet('player', 'game_assets/img/sprite/runner.png', 32, 32);
	//game.load.tilemap('area01', 'game_assets/map/area01.json', null, Phaser.Tilemap.TILED_JSON);
	//game.load.tilemap('area02', 'game_assets/map/area02.json', null, Phaser.Tilemap.TILED_JSON);
	game.load.tilemap('area03', 'game_assets/map/area03.json', null, Phaser.Tilemap.TILED_JSON);
    game.load.image('forest', 'game_assets/img/map/forest.png');
    game.load.image('metatiles32x32', 'game_assets/img/map/metatiles32x32.png');

}

var platforms = [];
var player;
var level;
var cursors;

function create()
{
    game.stage.backgroundColor = '#007575';
	//  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

	/*game.add.sprite(0, 0, 'title');

	//platforms = game.add.group();
	platforms.push(game.add.group());
	platforms.push(game.add.group());
	platforms.push(game.add.group());

	// enable physics for all our platforms
	platforms[0].enableBody = true;
	platforms[1].enableBody = true;
	platforms[2].enableBody = true;

	var x_pos = 0;

	for(var i = 0; i < 5; i++)
	{
		var floor = platforms[0].create(x_pos, game.world.height - 64, 'floor');
		floor.body.immovable = true;
		x_pos += 32;
	}
	for(var i = 0; i < 7; i++)
	{
		var floor = platforms[1].create(x_pos, game.world.height - 96, 'floor');
		floor.body.immovable = true;
		x_pos += 32;
	}
	for(var i = 0; i < 4; i++)
	{
		var floor = platforms[2].create(x_pos, game.world.height - 128, 'floor');
		floor.body.immovable = true;
		x_pos += 32;
	}*/
	//floor = platforms.create(640+32, game.world.height - 64, 'floor');

    // Generate our level.
    level = new phaserLevelGenerator(game, 'area03');
    level.generateLevel();
	
	// create our player
	player = game.add.sprite(32, game.world.height - 350, 'player');

	//add physics to our player
	//game.physics.arcade.enable(player);
    game.physics.enable(player, Phaser.Physics.ARCADE);
	player.body.gravity.y = 400;

	// add our player animations
	player.animations.add('left', [0, 1, 2, 3, 4], 10, true);
    level.addCollisionObject(player);

    cursors = game.input.keyboard.createCursorKeys();

}

function update()
{
	// collide the player with the platforms.
    level.update();
    
	player.animations.play('left')

    // debug code to check the level out.
    if(cursors.left.isDown)
    {
        game.camera.x -= 5;
    }
    if(cursors.right.isDown)
    {
        game.camera.x += 5;
    }
	//floor.body.velocity.x = 100;
	/*platforms[0].forEach(function(sprite) {
		sprite.body.velocity.x = -100;
		if (sprite.body.x <= -32)
		{
			sprite.body.x = 640;
		}
	})
	platforms[1].forEach(function(sprite) {
		sprite.body.velocity.x = -100;
		if (sprite.body.x <= -32)
		{
			sprite.body.x = 640;
		}
	})
	platforms[2].forEach(function(sprite) {
		sprite.body.velocity.x = -100;
		if (sprite.body.x <= -32)
		{
			sprite.body.x = 640;
		}
	})*/

	

	if(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR) &&
		player.body.touching.down)
	{
		player.body.velocity.y = -300;
		player.animations.stop();
	}
	if(player.body.touching.down)
	{
		player.body.velocity.x = 100;
	}
	else
	{
		player.body.velocity.x = 0;
	}

	//if(game.input.keyboard.isDown(Phaser.Keyboard.LEFT))
	//{
	//	player.body.velocity.x -= 50;
	//}
}

function render()
{

}

function playRunAnim(player, platform)
{
	//player.animations.play('left')
}

</script>
</body>
</html>
